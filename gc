#!/bin/bash

# Git æäº¤å¿«æ·å‘½ä»¤
# ä½¿ç”¨æ–¹æ³•: ./gc [type] [scope] [description]
# ä¾‹å¦‚: ./gc feat userManage "æ–°å¢ç”¨æˆ·ç®¡ç†åŠŸèƒ½"

# è·å–è„šæœ¬æ‰€åœ¨ç›®å½•ï¼ˆæ”¯æŒnpmå…¨å±€å®‰è£…ï¼‰
get_script_dir() {
    local script_path="$0"
    local script_dir=""
    
    # æ£€æŸ¥æ˜¯å¦æ˜¯npmå…¨å±€å®‰è£…
    if [[ "$script_path" == *"/node_modules/"* ]] || [[ "$script_path" == *"/npm/"* ]] || [[ "$script_path" == *"/nvm/"* ]]; then
        # npmå…¨å±€å®‰è£…çš„æƒ…å†µï¼ŒæŸ¥æ‰¾åŒ…å«æ‰€æœ‰è„šæœ¬çš„ç›®å½•
        local current_dir="$(dirname "$script_path")"
        
        # å‘ä¸ŠæŸ¥æ‰¾åŒ…å«git-commit.shçš„ç›®å½•
        while [[ "$current_dir" != "/" ]]; do
            if [[ -f "$current_dir/git-commit.sh" ]]; then
                script_dir="$current_dir"
                break
            fi
            current_dir="$(dirname "$current_dir")"
        done
        
        # å¦‚æœè¿˜æ˜¯æ‰¾ä¸åˆ°ï¼Œå°è¯•ä½¿ç”¨whichå‘½ä»¤
        if [[ -z "$script_dir" ]]; then
            local gc_path="$(which gc 2>/dev/null)"
            if [[ -n "$gc_path" ]]; then
                local gc_dir="$(dirname "$gc_path")"
                # å°è¯•å¸¸è§çš„npmå…¨å±€å®‰è£…è·¯å¾„
                local possible_paths=(
                    "$gc_dir/../lib/node_modules/gc-npm-package"
                    "$gc_dir/../node_modules/gc-npm-package"
                    "/usr/local/lib/node_modules/gc-npm-package"
                    "/opt/homebrew/lib/node_modules/gc-npm-package"
                )
                
                for path in "${possible_paths[@]}"; do
                    if [[ -f "$path/git-commit.sh" ]]; then
                        script_dir="$path"
                        break
                    fi
                done
            fi
        fi
    fi
    
    # å¦‚æœä¸Šé¢çš„æ–¹æ³•éƒ½å¤±è´¥äº†ï¼Œä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•
    if [[ -z "$script_dir" ]]; then
        script_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
    fi
    
    echo "$script_dir"
}

SCRIPT_DIR="$(get_script_dir)"

# æ£€æŸ¥ä¸»è„šæœ¬æ˜¯å¦å­˜åœ¨
if [[ -f "$SCRIPT_DIR/git-commit.sh" ]]; then
    # è°ƒç”¨ä¸»è„šæœ¬
    "$SCRIPT_DIR/git-commit.sh" "$@"
else
    echo "âŒ é”™è¯¯ï¼šæ‰¾ä¸åˆ° git-commit.sh è„šæœ¬"
    echo "è¯·ç¡®ä¿ gc å’Œ git-commit.sh åœ¨åŒä¸€ç›®å½•ä¸‹"
    echo "å½“å‰è„šæœ¬ç›®å½•: $SCRIPT_DIR"
    echo "æŸ¥æ‰¾çš„è„šæœ¬è·¯å¾„: $SCRIPT_DIR/git-commit.sh"
    echo ""
    echo "ğŸ’¡ æç¤ºï¼šå¦‚æœä½¿ç”¨npmå…¨å±€å®‰è£…ï¼Œè¯·å°è¯•é‡æ–°å®‰è£…ï¼š"
    echo "   npm uninstall -g gc-npm-package"
    echo "   npm install -g gc-npm-package"
    exit 1
fi
